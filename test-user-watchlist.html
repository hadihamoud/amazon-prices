<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test User Watchlist System</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .user-section {
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        .user-section.new-user {
            border-color: #10b981;
            background-color: #f0fdf4;
        }
        .user-section.existing-user {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        .product {
            display: inline-block;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 10px;
            margin: 5px;
            background: white;
            width: 200px;
        }
        .product img {
            width: 60px;
            height: 60px;
            object-fit: contain;
            border: 1px solid #eee;
            border-radius: 4px;
        }
        .product-title {
            font-weight: bold;
            font-size: 12px;
            margin: 5px 0;
        }
        .product-price {
            color: #059669;
            font-size: 14px;
            font-weight: bold;
        }
        .status-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        .status-new { background: #10b981; color: white; }
        .status-existing { background: #3b82f6; color: white; }
        .admin-tracked {
            background: #fef3c7;
            border-color: #f59e0b;
        }
        .button {
            background: #f59e0b;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .button:hover {
            background: #d97706;
        }
        .instructions {
            background: #dbeafe;
            border: 1px solid #3b82f6;
            border-radius: 6px;
            padding: 15px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>Test User Watchlist System</h1>
    <p>This page demonstrates the admin tracked products and user watchlist system.</p>
    
    <div class="instructions">
        <h3>How to Test:</h3>
        <ol>
            <li>Open the main application</li>
            <li>Go to Admin Dashboard → "Tracked Products" tab</li>
            <li>Add products to the tracked list</li>
            <li>Create new users (they get tracked products automatically)</li>
            <li>View user watchlists in Admin Dashboard → "User Watchlists" tab</li>
            <li>Existing users' watchlists remain independent</li>
        </ol>
    </div>

    <div class="container">
        <h2>Admin Tracked Products</h2>
        <p>These products are automatically added to new users' watchlists:</p>
        <div id="admin-tracked"></div>
    </div>

    <div class="container">
        <h2>Simulated Users</h2>
        <div id="users"></div>
    </div>

    <div class="container">
        <h2>Test Controls</h2>
        <button class="button" onclick="createNewUser()">Create New User</button>
        <button class="button" onclick="createExistingUser()">Create Existing User</button>
        <button class="button" onclick="addAdminProduct()">Add Admin Product</button>
        <button class="button" onclick="refreshData()">Refresh Data</button>
    </div>

    <script>
        // Simulate the user watchlist service
        let adminTrackedProducts = [
            {
                id: 'admin-tracked-1',
                title: 'Apple AirPods Pro (2nd Generation)',
                price: 199.99,
                imageUrl: 'https://images.unsplash.com/photo-1606220945770-b5b6c2c55bf1?w=200&h=200&fit=crop',
                productUrl: 'https://www.amazon.com/dp/B0BDJDR6J8',
                asin: 'B0BDJDR6J8',
                currentPrice: 249.99,
                addedAt: new Date().toISOString(),
                addedBy: 'admin'
            },
            {
                id: 'admin-tracked-2',
                title: 'Samsung Galaxy S23 Ultra 256GB',
                price: 999.99,
                imageUrl: 'https://images.unsplash.com/photo-1610945265064-3e4e5d5b5b5b?w=200&h=200&fit=crop',
                productUrl: 'https://www.amazon.com/dp/B0BQJ8QZ8Z',
                asin: 'B0BQJ8QZ8Z',
                currentPrice: 1199.99,
                addedAt: new Date().toISOString(),
                addedBy: 'admin'
            }
        ];

        let users = [
            {
                userId: 'user-1',
                products: [...adminTrackedProducts],
                createdAt: new Date().toISOString(),
                lastUpdated: new Date().toISOString(),
                isInitialized: false,
                type: 'new'
            },
            {
                userId: 'user-2',
                products: [
                    {
                        id: 'user-2-product-1',
                        title: 'MacBook Pro 14-inch M2 Chip',
                        price: 1999.99,
                        imageUrl: 'https://images.unsplash.com/photo-1541807084-5c52b6b3adef?w=200&h=200&fit=crop',
                        productUrl: 'https://www.amazon.com/dp/B0BQJ8QZ8Z',
                        asin: 'B0BQJ8QZ8Z',
                        currentPrice: 2199.99
                    }
                ],
                createdAt: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString(),
                lastUpdated: new Date().toISOString(),
                isInitialized: true,
                type: 'existing'
            }
        ];

        function displayAdminTracked() {
            const container = document.getElementById('admin-tracked');
            container.innerHTML = '';
            
            adminTrackedProducts.forEach(product => {
                const productDiv = document.createElement('div');
                productDiv.className = 'product admin-tracked';
                productDiv.innerHTML = `
                    <img src="${product.imageUrl}" alt="${product.title}">
                    <div class="product-title">${product.title}</div>
                    <div class="product-price">$${product.price.toFixed(2)}</div>
                    <div style="font-size: 10px; color: #666;">Added: ${new Date(product.addedAt).toLocaleDateString()}</div>
                `;
                container.appendChild(productDiv);
            });
        }

        function displayUsers() {
            const container = document.getElementById('users');
            container.innerHTML = '';
            
            users.forEach(user => {
                const userDiv = document.createElement('div');
                userDiv.className = `user-section ${user.type}-user`;
                
                const statusClass = user.isInitialized ? 'status-existing' : 'status-new';
                const statusText = user.isInitialized ? 'Independent' : 'Auto-Updated';
                
                userDiv.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <h3>User: ${user.userId}</h3>
                        <span class="status-badge ${statusClass}">${statusText}</span>
                    </div>
                    <p style="font-size: 12px; color: #666; margin: 5px 0;">
                        Created: ${new Date(user.createdAt).toLocaleDateString()} | 
                        Last Updated: ${new Date(user.lastUpdated).toLocaleDateString()}
                    </p>
                    <p style="font-size: 12px; color: #666; margin: 5px 0;">
                        Status: ${user.isInitialized ? 'Initialized (Independent)' : 'Not Initialized (Gets Admin Updates)'}
                    </p>
                    <div style="margin-top: 10px;">
                        <strong>Products (${user.products.length}):</strong>
                        <div id="products-${user.userId}"></div>
                    </div>
                `;
                
                container.appendChild(userDiv);
                
                // Display products for this user
                const productsContainer = document.getElementById(`products-${user.userId}`);
                user.products.forEach(product => {
                    const productDiv = document.createElement('div');
                    productDiv.className = 'product';
                    productDiv.innerHTML = `
                        <img src="${product.imageUrl}" alt="${product.title}">
                        <div class="product-title">${product.title}</div>
                        <div class="product-price">$${product.price.toFixed(2)}</div>
                    `;
                    productsContainer.appendChild(productDiv);
                });
            });
        }

        function createNewUser() {
            const userId = `user-${Date.now()}`;
            const newUser = {
                userId,
                products: [...adminTrackedProducts], // New users get admin tracked products
                createdAt: new Date().toISOString(),
                lastUpdated: new Date().toISOString(),
                isInitialized: false,
                type: 'new'
            };
            users.push(newUser);
            displayUsers();
            console.log('Created new user:', userId);
        }

        function createExistingUser() {
            const userId = `user-${Date.now()}`;
            const existingUser = {
                userId,
                products: [
                    {
                        id: `${userId}-product-1`,
                        title: 'Custom Product',
                        price: 299.99,
                        imageUrl: 'https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=200&h=200&fit=crop',
                        productUrl: 'https://www.amazon.com/dp/EXAMPLE',
                        asin: 'EXAMPLE123'
                    }
                ],
                createdAt: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString(),
                lastUpdated: new Date().toISOString(),
                isInitialized: true, // Existing users are independent
                type: 'existing'
            };
            users.push(existingUser);
            displayUsers();
            console.log('Created existing user:', userId);
        }

        function addAdminProduct() {
            const newProduct = {
                id: `admin-tracked-${Date.now()}`,
                title: `New Admin Product ${adminTrackedProducts.length + 1}`,
                price: Math.floor(Math.random() * 500) + 50,
                imageUrl: 'https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=200&h=200&fit=crop',
                productUrl: 'https://www.amazon.com/dp/EXAMPLE',
                asin: `EXAMPLE${Date.now()}`,
                currentPrice: Math.floor(Math.random() * 500) + 100,
                addedAt: new Date().toISOString(),
                addedBy: 'admin'
            };
            
            adminTrackedProducts.push(newProduct);
            
            // Add to non-initialized users (simulating the real behavior)
            users.forEach(user => {
                if (!user.isInitialized) {
                    user.products.push(newProduct);
                    user.lastUpdated = new Date().toISOString();
                }
            });
            
            displayAdminTracked();
            displayUsers();
            console.log('Added admin product:', newProduct.title);
        }

        function refreshData() {
            displayAdminTracked();
            displayUsers();
        }

        // Initialize
        displayAdminTracked();
        displayUsers();
    </script>
</body>
</html>


